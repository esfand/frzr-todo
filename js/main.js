"use strict";!function(){function t(){this.listeners={}}function e(t,e){var n=document.createElement(t);if("undefined"!=typeof e)for(var o in e)n.setAttribute(o,e[o]);return n}function n(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg",t);if("undefined"!=typeof e)for(var o in e)n.setAttribute(e,e[o]);return n}function o(t){E.length||(C.trigger("render"),b(r)),E.push(t)}function r(){for(var t=E.splice(0,E.length),e=0,n=t.length;n>e;e++)t[e]();return 0===E.length?void C.trigger("rendered"):void r()}function i(t,e){for(var n=t.length,o=0;n>o;o++)e(t[o],o,n)}function s(t,e){for(var n,o=[],r=t.length,i=0;r>i;i++)n=t[i],e(n,i,r)&&o.push(n);return o}function u(t){if(!t||!t.length)return t;for(var e,n,o=t.length-1;o>0;o--)e=Math.random()*o|0,n=t[o],t[o]=t[e],t[e]=n;return t}function a(t,e){for(var n=t.length,o=new Array(n),r=0;n>r;r++)o[r]=e(t[r],r,n);return o}function l(t,e){t["super"]=e,t.prototype=Object.create(e.prototype,{constructor:{configurable:!0,value:t,writable:!0}})}function f(t){var o=this,r=o instanceof f;if(!r)return new f(t);var i=t&&t.svg||!1;f["super"].call(o),o.$el=i?n(t.el||"svg"):e(t.el||"div"),o.$root=null,o.parent=null,o.data={},o._attrs={},o._class={},o._style={},o._text="",t&&o.opt(t,null,!0),o.trigger("init",o),t.data&&o.set(t.data),o.trigger("inited",o)}function c(){this.trigger("parentmount")}function d(){this.trigger("parentmounted")}function p(){this.$el.focus()}function g(t,e){var n=this instanceof g;return n?(this.view=new f(e),this.views=[],this.lookup={},void(this.ChildView=t||f)):new g(t,e)}function h(t,e){C.on("render",function(){D=Date.now()}),C.on("rendered",function(){e.textContent="Rendering took "+(Date.now()-D)+" ms"})}function v(t,e){var n=new f({el:"h1",text:"Todo"}),o=new f({el:"p",text:"(items stay between refreshes)",style:{fontStyle:"italic"}});n.mount(e),o.mount(e)}function y(t,e){function n(e){e.preventDefault();var n={id:Date.now(),title:s.$el.value||A[0],done:!1};t.trigger("todo-create",n),s.$el.value="",u(A),s.attr({placeholder:A[0]}),s.$el.focus()}function o(){a.$el.blur(),t.trigger("todo-clear")}function r(){l.$el.blur(),t.trigger("todo-clearall")}var i=new f({el:"form",listen:{submit:n},$root:e}),s=(new f({el:"h2",text:"What to do?",parent:i}),new f({el:"input",attr:{autofocus:!0,placeholder:A[0]},parent:i})),a=(new f({el:"button",text:"Insert",parent:i}),new f({el:"button",text:"Clear done",listen:{click:o},$root:e})),l=new f({el:"button",text:"Clear all",listen:{click:r},$root:e})}function m(){var t=this;t.checkbox=new f({el:"input",attr:{type:"checkbox"},parent:t}),t.title=new f({el:"span"}),t.checkbox.mount(t.$el),t.title.mount(t.$el)}function w(){var t=this;t.data.done=!t.data.done,t.parent.root.trigger("todo-update",t.data)}function $(t){var e=this;e.title.text(t.title),e.checkbox.attr({checked:t.done})}function x(t,e){var n=new g(P,{el:"ul","class":"todoitems",root:t});n.reset(k,"id"),n.mount(e),t.on("todo-create",function(t){k.push(t),n.reset(k,"id"),_.setItem("todoitems",JSON.stringify(k))}),t.on("todo-update",function(t){k=a(n.views,function(t){return t.data}),_.setItem("todoitems",JSON.stringify(k)),n.reset(k,"id")}),t.on("todo-clear",function(){var t=s(n.views,function(t){return!t.data.done});k=a(t,function(t){return t.data}),n.reset(k,"id"),_.setItem("todoitems",JSON.stringify(k))}),t.on("todo-clearall",function(){k=[],n.reset(k,"id"),_.setItem("todoitems",JSON.stringify([]))})}t.prototype.on=function(t,e,n,o){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push({once:o||!1,cb:e,ctx:n})},t.prototype.one=function(t,e,n){this.on(t,e,n,!0)},t.prototype.off=function(t,e,n){if("undefined"==typeof t)return void(this.listeners={});if("undefined"==typeof e)return void(this.listeners[t]=[]);var o=this.listeners[t];if(o)for(var r=0,i=o.length;i>r;r++)n?o[r].ctx===n&&(o.splice(r--,1),i--):o[r].cb===e&&(o.splice(r--,1),i--)},t.prototype.trigger=function(t){for(var e=this.listeners[t],n=arguments.length-1,o=new Array(n),r=0;n>r;r++)o[r]=arguments[r+1];if(e){var i;for(r=0;r<e.length;r++)i=e[r],i.cb.apply(i.ctx||this,o),i.once&&(e.splice(r--,1),n--)}};var E=[],b=window.requestAnimationFrame||function(t){setTimeout(t,1e3/60)},C=new t;l(f,t),f.extend=function(t){return function(e){if(!e)return new f(t);var n={};for(var o in t)n[o]=t[o];for(o in e)n[o]=e[o];return new f(n)}},f.prototype.mount=function(t){var e=this;e.parent&&(e.parent.off("mount",c,e),e.parent.off("mounted",d,e)),e.$root&&(e.trigger("unmount"),e.trigger("unmounted")),t instanceof f?(e.parent=t,e.$root=t.$el):e.$root=t,o(function(){e.parent&&(e.parent.on("mount",c,e),e.parent.on("mounted",d,e)),e.trigger("mount"),e.$root.appendChild(e.$el),e.trigger("mounted")})},f.prototype.unmount=function(){var t=this,e=t.$el;t.$root&&(t.parent&&(t.parent.off("mount",c,t),t.parent.off("mounted",d,t)),o(function(){t.trigger("unmount"),t.$root.removeChild(e),t.$root=null,t.parent=null,t.trigger("unmounted")}))},f.prototype.destroy=function(){var t=this;t.trigger("destroy"),t.off(),t.unmount(),t.trigger("destroyed")},f.prototype.mountBefore=function(t,e){var n=this,r=n.$el;n.$root=t,o(function(){t.insertBefore(r,e)})},f.prototype.set=function(t,e){var n=this,r={};"string"==typeof t?r[t]=e:null!=t&&(r=t),o(function(){n.trigger("render")}),n.trigger("update",r);for(t in r)n.data[t]=r[t];n.trigger("updated"),o(function(){n.trigger("rendered")})},f.prototype.opt=function(t,e,n){var o=this,r={};if("undefined"!=typeof t){"string"==typeof t?r[t]=e:null!=t&&(r=t);for(t in r)if("attrs"===t)console.error('DEPRECATED! Please use "attr" instead..'),o.attr(r.attrs);else if("attr"===t)o.attr(r.attr);else if("href"===t)o.attr({href:r.href});else if("id"===t)o.attr({id:r.id});else if("data"===t)n||o.set(r.data);else if("style"===t){if("string"==typeof r.style){o.attr({style:r.style});continue}o.style(r.style)}else if("class"===t){if("string"==typeof r["class"]){o.attr({"class":r["class"]});continue}o["class"](r["class"])}else"textContent"===t?(console.error('DEPRECATED! Please use "text" instead..'),o.text(r.textContent)):"text"===t?o.text(r.text):"listen"===t?o.listen(r.listen):"init"===t?o.on("init",r.init):"update"===t?o.on("update",r.update):"parent"===t?o.mount(r.parent):"$root"===t?o.mount(r.$root):o[t]=r[t]}},f.prototype.addListeners=function(t,e){console.error("DEPRECATED! Please use .listen instead.."),this.listen(t,e)},f.prototype.textContent=function(t,e){console.error("DEPRECATED! Please use .text instead.."),this.text(t,e)},f.prototype.setOptions=function(t,e){console.error("DEPRECATED! Please use .opt instead.."),this.opt(t,e)},f.prototype.setAttributes=function(t,e){console.error("DEPRECATED! Please use .attr instead.."),this.attr(t,e)},f.prototype.setClass=function(t,e){console.error("DEPRECATED! Please use .class instead.."),this["class"](t,e)},f.prototype.setStyle=function(t,e){console.error("DEPRECATED! Please use .style instead.."),this.style(t,e)},f.prototype.text=function(t){var e=this,n=e.$el;t!==e._text&&(e._text=t,o(function(){t===e._text&&(n.textContent=t)}))},f.prototype.listen=function(t,e){function n(t,e){o.on(t,e),r.addEventListener(t,function(e){o.trigger(t,e)})}var o=this,r=o.$el,i={};"string"==typeof t?i[t]=e:null!=t&&(i=t);for(t in i)e=i[t],n(t,e)},f.prototype["class"]=function(t,e){function n(t,e){o(function(){r._class[t]===e&&(e?i.classList.add(t):i.classList.remove(t))})}var r=this,i=r.$el,s={};"string"==typeof t?s[t]=e:null!=t&&(s=t);for(t in s)e=s[t],r._class[t]!==e&&(r._class[t]=e,n(t,e))},f.prototype.style=function(t,e){function n(t,e){o(function(){r._style[t]===s[t]&&(i.style[t]=e)})}var r=this,i=r.$el,s={};"string"==typeof t?s[t]=e:null!=t&&(s=t);for(t in s)e=s[t],r._style[t]!==e&&(r._style[t]=e,n(t,e))},f.prototype.attr=function(t,e){function n(t,e){o(function(){if(e===i._attrs[t]){if(e===!1||null==e)return void s.removeAttribute(t);s.setAttribute(t,e),"autofocus"===t&&(e?(s.focus(),i.on("mounted",p),i.on("parentmounted",p,i)):(i.off("mounted",p),i.off("parentmounted",p,i)))}})}var r,i=this,s=i.$el,u=i._attrs,a={};"string"==typeof t?a[t]=e:null!=t&&(a=t);for(r in a)e=a[r],e!==u[r]&&(i._attrs[r]=e,e===i._attrs[r]&&n(r,e))},l(g,t),g.prototype.mount=function(t){this.view.mount(t)},g.prototype.mountBefore=function(t,e){this.view.mountBefore(t,e)},g.prototype.unmount=function(){this.view.unmount()},g.prototype.reset=function(t,e){var n=this,o=n.ChildView,r=new Array(t.length),s={},u=n.lookup;i(t,function(t,i){var a=e?t[e]:i,l=u[a];l||(l=new o({parent:n.view})),s[a]=l,l.set(t),r[i]=l});for(var a in u)s[a]||u[a].destroy();n.views=r,n.lookup=s,n.reorder()},g.prototype.reorder=function(){var t=this,e=t.view.$el;o(function(){var n=e.firstChild;i(t.views,function(t,o){return n===t.$el?void(n=n.nextSibling):void(n?(t.$root=e,e.insertBefore(t.$el,n)):(t.$root=e,e.appendChild(t.$el)))});for(var o;n;)o=n.nextSibling,e.removeChild(n),n=o})};var D,A=["Buy milk","Feed cat","Go fishing","Pay rent","Watch a movie","Learn to cook"];u(A);var P=f.extend({el:"li","class":"todoitem",listen:{click:w},init:m,update:$}),_=window.localStorage,k=JSON.parse(_.getItem("todoitems"))||[],S=document.getElementById("rendertime"),T=document.getElementById("container"),R=new t;h(R,S),v(R,T),y(R,T),x(R,T)}();